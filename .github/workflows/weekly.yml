name: Weekly GitHub Report

on:
  # 1. 定时触发：每周一早上 09:00 (北京时间)
  # GitHub 使用 UTC 时间，北京时间是 UTC+8
  # 所以北京时间 09:00 = UTC 时间 01:00
  schedule:
    - cron: '0 1 * * 1'
  
  # 2. 手动触发：方便你测试，不用等一周
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    # 第一步：把代码拉取下来
    - name: Checkout code
      uses: actions/checkout@v3

    # 第二步：安装 Python 环境
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    # 第三步：安装依赖库
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install requests

    # 第四步：运行脚本
    - name: Run script
      env:
        # 将 GitHub Secrets 注入到环境变量中
        SENDER_EMAIL: ${{ secrets.SENDER_EMAIL }}
        AUTH_CODE: ${{ secrets.AUTH_CODE }}
        RECEIVER_EMAIL: ${{ secrets.RECEIVER_EMAIL }}
      run: python main.py
